<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Atelier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: #fff; -webkit-font-smoothing: antialiased; }
        .order-card { background: #1c1c1e; border-radius: 20px; border: 1px solid #2c2c2e; overflow: hidden; }
        .btn-archive { background: #34C759; color: #fff; border-radius: 12px; padding: 14px; font-weight: 700; width: 100%; transition: 0.2s; }
        .btn-archive:active { transform: scale(0.96); opacity: 0.8; }
        .status-badge { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; }
    </style>
</head>
<body class="p-6">

    <header class="flex justify-between items-start mb-10">
        <div>
            <h1 class="text-4xl font-black tracking-tight">Atelier</h1>
            <p class="text-zinc-500 font-medium">Flux de production en direct</p>
        </div>
        <button onclick="loadOrders()" class="bg-zinc-800 p-3 rounded-full active:rotate-180 transition-transform">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        </button>
    </header>

    <div id="orderGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        </div>

    <script>
        const API_URL = "TON_URL_APPS_SCRIPT_ICI"; // <--- METS TON URL ICI

        async function loadOrders() {
            const res = await fetch(API_URL);
            const data = await res.json();
            const grid = document.getElementById('orderGrid');
            grid.innerHTML = '';

            data.reverse().forEach(order => {
                const card = document.createElement('div');
                card.className = "order-card flex flex-col";
                card.innerHTML = `
                    <div class="p-5 flex justify-between items-center bg-zinc-900/50">
                        <div>
                            <p class="text-[10px] text-zinc-500 font-bold uppercase">${order.orderNo}</p>
                            <h2 class="text-lg font-bold">${order.client}</h2>
                        </div>
                        <span class="status-badge ${order.paid === 'OUI' ? 'bg-green-500/20 text-green-500' : 'bg-red-500/20 text-red-500'}">
                            ${order.paid === 'OUI' ? 'PAYÉ' : 'À RÉGLER'}
                        </span>
                    </div>
                    <div class="p-2 bg-white">
                        <img src="${order.ficheUrl}" class="w-full h-auto rounded-lg shadow-lg">
                    </div>
                    <div class="p-5 mt-auto space-y-4">
                        <div class="text-sm text-zinc-400">
                            <p><strong>Détails :</strong> ${order.details}</p>
                            <p class="mt-1 italic">"${order.email || 'Pas d\'email'}"</p>
                        </div>
                        <button onclick="terminer('${order.orderNo}')" id="btn-${order.orderNo}" class="btn-archive">
                            TERMINÉ & PRÉVENIR CLIENT
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        async function terminer(id) {
            const btn = document.getElementById('btn-'+id);
            btn.innerText = "Archivage...";
            btn.disabled = true;

            // Appel de la fonction archive du script Google
            await fetch(`${API_URL}?action=archive&orderNo=${id}`);
            
            alert("Commande terminée. Le client va recevoir son mail !");
            loadOrders(); // Rafraîchir la liste
        }

        loadOrders();
        setInterval(loadOrders, 60000); // Check auto toutes les minutes
    </script>
</body>
</html>
